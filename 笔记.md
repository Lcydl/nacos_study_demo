# 微服务

### 定义

微服务架构是一种架构模式，它提倡将单一应用程序划分为**一组小的服务**，服务之间互相协调、互相配合，为用户提供最终价值。

每个服务运行在其**独立的进程**中，服务与服务间采用**轻量级的通信机制**互相协作（通常是基于HTTP协议的Restful API）。

每个服务都围绕着具体业务进行构建，并且能够被**独立的部署**到生产环境、类生产环境等。

另外，应当尽量避免统一的、集中式的服务管理机制，对具体的一个服务而言，应根据业务上下文，选择合适的语言、工具对其进行构建。



### 构成

- 服务注册与发现
- 服务调用
- 服务熔断
- 负载均衡
- 服务降级
- 服务消息队列
- 配置中心管理
- 服务网关
- 服务监控
- 全链路追踪
- 自动化构建部署
- 服务定时任务调度操作



## SpringCloud

### 版本

| Cloud版本                                                    | Boot版本                              |
| :----------------------------------------------------------- | :------------------------------------ |
| [2021.0.x](https://github.com/spring-cloud/spring-cloud-release/wiki/Spring-Cloud-2021.0-Release-Notes) aka Jubilee | 2.6.x                                 |
| [2020.0.x](https://github.com/spring-cloud/spring-cloud-release/wiki/Spring-Cloud-2020.0-Release-Notes) aka Ilford | 2.4.x, 2.5.x (Starting with 2020.0.3) |
| [Hoxton](https://github.com/spring-cloud/spring-cloud-release/wiki/Spring-Cloud-Hoxton-Release-Notes) | 2.2.x, 2.3.x (Starting with SR5)      |
| [Greenwich](https://github.com/spring-projects/spring-cloud/wiki/Spring-Cloud-Greenwich-Release-Notes) | 2.1.x                                 |
| [Finchley](https://github.com/spring-projects/spring-cloud/wiki/Spring-Cloud-Finchley-Release-Notes) | 2.0.x                                 |
| [Edgware](https://github.com/spring-projects/spring-cloud/wiki/Spring-Cloud-Edgware-Release-Notes) | 1.5.x                                 |
| [Dalston](https://github.com/spring-projects/spring-cloud/wiki/Spring-Cloud-Dalston-Release-Notes) | 1.5.x                                 |

> [版本查看]: https://start.spring.io/actuator/info



### 组件

- 注册中心

  ~~`Eureka`~~

  `Zookeeper`

  `Consul`

  `Nacos`

- 负载均衡

  `Ribbon`

  `LoadBalance`

- 服务调用

  ~~`Feign`~~

  `OpenFeign`

- 服务降级

  ~~`Hystrix`~~

  `Resilience4j`

  `Sentienl`

- 服务网关

  ~~`Zuul`~~

  `Zuul2`

  `Gateway`

- 服务配置

  ~~`Config`~~

  `Nacos`

  `Apollo`

- 服务总线

  ~~`Bus`~~

  `Nacos`

## Eureka

### 服务治理

Spring Cloud封装了Netflix公司开发的Eureka模块来实现服务治理
在传统了rpc远程调用框架中，管理每个服务与服务之间的依赖关系比较复杂，所以需要使用服务治理，可以实现服务调用、负载均衡、容错等，实现服务发现与注册

### 服务注册与发现
Eureka采用了CS的设计架构，Eureka Server作为服务注册功能的服务器，它是服务注册中心。而系统中的其他微服务，使用Eureka的客户端连接到Eureka Server并维持心跳连接。这样系统的维护人员就可以通过Eureka Server来监控系统中各个微服务是否正常运行。

在服务注册与发现中，有一个注册中心，当服务器启动的时候，会把当前自己服务器的信息比如服务地址通讯地址等以别名方式注册到注册中心上。另一方（消费者|服务提供者）以该别名的方式去注册中心上获取到实际的服务通讯地址，然后再实现本地RPC远程调用框架核心设计思想：在于注册中心，因为使用注册中心管理每个服务与服务之间的依赖关系（服务治理概念）。在任何rpc远程调用框架中，都会有一个注册中心存放服务地址相关信息（接口地址）

### Server与Client

**Eureka Server（提供注册服务）**
各个微服务节点通过配置后，会在Eureka Server中进行注册，这样Eureka Server的服务注册表中将会存储所有可用服务节点的信息，而且可以在界面中直观看到

**Eureka Client（通过注册中心访问）**
一个Java客户端，用于简化Eureka Server的交互，客户端具备一个内置的、使用轮询（round-robin）负载算法的负载均衡器。在应用启动后，将会向Eureka Server发送心跳（默认周期30秒）。如果Eureka Server在多个心跳周期内没有接收到某个节点的心跳，Eureka Server将会从服务注册表中把这个服务节点移除（默认90秒）
